<div class="uncharted-journeys chat-card resolution-check group-check">
  <h3><i class="fas fa-users"></i> Group Check</h3>

  <p>Each party member must make one of these checks:</p>
  <p class="dc-info"><strong>DC:</strong> {{dc}}{{#if dcModifier}} <span class="dc-modifier">({{#if (gt dcModifier 0)}}+{{/if}}{{dcModifier}} from {{keyRoleName}} check)</span>{{/if}}</p>

  {{#if advantageState}}
  <p class="advantage-note">
    {{#if (eq advantageState "advantage")}}
    <i class="fas fa-arrow-up"></i> <strong>Advantage</strong> on all checks from {{keyRoleName}}'s preparation
    {{else}}
    <i class="fas fa-arrow-down"></i> <strong>Disadvantage</strong> on all checks from {{keyRoleName}}'s guidance
    {{/if}}
  </p>
  {{/if}}

  <div class="check-prompt skill-options">
    {{#each skillChecks}}
    <p>{{{this}}}</p>
    {{/each}}
    {{#if saveCheck}}
    <p>{{{saveCheck}}}</p>
    {{/if}}
  </div>

  {{#if canReplace}}
  <div class="replacement-option">
    <p><i class="fas fa-exchange-alt"></i> <strong>{{replacerName}}</strong> ({{replacerRole}}) can use their result for one ally:</p>
    <div class="replacement-checkboxes">
      {{#each otherMembers}}
      <label class="replacement-target">
        <input type="checkbox" name="replaceTarget" value="{{actorId}}" data-replacer-id="{{../replacerId}}">
        {{name}}
      </label>
      {{/each}}
    </div>
  </div>
  {{/if}}

  <div class="group-results" data-encounter-index="{{encounterIndex}}">
    {{#each partyMembers}}
    <div class="member-result-row" data-actor-id="{{actorId}}">
      <span class="member-name">{{name}}</span>
      <div class="result-buttons">
        <button type="button" class="success-btn" data-action="setMemberResult" data-actor-id="{{actorId}}" data-result="success">
          <i class="fas fa-check"></i>
        </button>
        <button type="button" class="failure-btn" data-action="setMemberResult" data-actor-id="{{actorId}}" data-result="failure">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <span class="result-display"></span>
    </div>
    {{/each}}
  </div>

  <div class="group-tally">
    <span>Successes: <strong class="success-count">0</strong>/{{partySize}}</span>
    <button type="button" class="finalize-btn" data-action="finalizeGroupCheck" data-encounter-index="{{encounterIndex}}" disabled>
      <i class="fas fa-check-double"></i> Finalize Results
    </button>
  </div>

  {{#if isGM}}
  <div class="outcome-preview">
    <p class="outcome-tier outcome-all"><strong>All succeed:</strong> {{outcomes.all}}</p>
    <p class="outcome-tier outcome-majority"><strong>Majority:</strong> {{outcomes.majority}}</p>
    <p class="outcome-tier outcome-minority"><strong>Half or fewer:</strong> {{outcomes.minority}}</p>
    <p class="outcome-tier outcome-none"><strong>None succeed:</strong> {{outcomes.none}}</p>
  </div>
  {{/if}}
</div>
